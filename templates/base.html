{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block outercss %}
    {% endblock %}
    <link rel="stylesheet" href="{% static 'base.css' %}">
    {% block header %}{% endblock header %}
    <title>{% block title %}{% endblock title %}</title>
</head>
<body>
    <div class="nav-cont">
        <nav class="navbar">
            <a href="{% url 'index' %}">
                <div id="logo"><h1>JUMII</h1><img class="logo" src="https://img.icons8.com/pastel-glyph/64/000000/fast-cart.png"/></div>
            </a>
            <div class="nav-items-container">
                <div class="searchbar">
                    <input type="text" placeholder="Search products, brands and categories" name="search" id="nav-searchbar">
                    <button class="search-btn" >SEARCH</button>
                </div>
                <div class="rightmost-nav-items">
                    <a href="{% url 'account' %}"><div class="login"><img src="https://img.icons8.com/ios/24/000000/user--v1.png"/><span>Account</span></div></a>
                    <!-- <div class="help"><img src="https://img.icons8.com/ios/24/000000/help.png"/>Help</div> -->
                   <a href="{% url 'cart' %}"><div class="cart"><img src="https://img.icons8.com/ios/24/000000/shopping-cart.png"/><span>Cart</span> {% if request.user.is_authenticated %}<span id="cart-count"></span>{% endif %}</div></a>
                </div>
            </div>
            <div class="searchbar mobile">
                <input type="text" placeholder="Search products, brands and categories" name="search" id="nav-searchbar">
            </div>
        </nav>
    </div>
    
    {% block content %}

    {% endblock content %}

<script>

function getToken(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          // Does this cookie string begin with the name we want?
          if (cookie.substring(0, name.length + 1) === (name + '=')) {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }

    let userCartCountUrl =  location.origin.toString()+'/cart_total/'
        console.log(userCartCountUrl)
        fetch(userCartCountUrl, {
            method: 'GET'
        })
        .then(response => response.json())
        .then(resp => {
            if(resp['total']){
                document.getElementById('cart-count').textContent = resp['total']
            }
        })

function redirectToLogin(){
    let current_user = "{{ request.user }}"
    if(current_user=='ANONYMOUS_USER'){
        alert(current_user)
        window.location.href = '/account/'
    }
    console.log(current_user)
}

const csrftoken = getToken('csrftoken');
</script>

{% block js %}{% endblock js %}
</body>
</html>